<!DOCTYPE html>
<html lang="ja" data-bs-theme="spaceship">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <!-- Agent CSS -->
    <link href="assets/cmdbox/color_mode.css" rel="stylesheet">
    <link href="assets/agent/agent.css" rel="stylesheet">
</head>

<body>
<div class="layout-grid split-pane fixed-left">
    <!-- LEFT PANEL: Console / Chat Interface -->
    <aside class="console-panel split-pane-component">
        <div class="d-flex align-items-center console-header justify-content-between">
            <h5 class="d-inline-block m-0 glow-text-cyan system-font">
                <span class="d-flex align-items-center">
                    <i class="fas fa-terminal me-2"></i>
                    <span id="logo_title">LOG_INTERFACE</span>
                </span>
            </h5>
            <div class="d-none dropdown user_info" style="font-size: 0.8rem;">
                <a href="#" class="d-block text-decoration-none dropdown-toggle show" data-bs-toggle="dropdown" aria-expanded="true">
                    <div class="d-inline-block me-1">
                        <svg width="24" height="24" viewBox="0 0 16 16" style="fill:var(--accent-cyan);vertical-align:inherit;">
                            <use href="#svg_signin_ico"></use>
                        </svg>
                    </div>
                    <div class="d-inline-block">
                        <span class="text-white-50">USER: <span class="username glow-text-magenta">UserName</span></span>
                        <br/>
                        <span class="text-white-50">STATUS: <span style="color:var(--accent-green)">ONLINE</span></span>
                    </div>
                </a>
                <ul class="dropdown-menu text-small shadow" style="position: absolute; inset: 0px 0px auto auto; margin: 0px; transform: translate(0px, 34px);" data-popper-placement="bottom-end">
                    <div class="user_info_note ps-3 pe-3"></div>
                    <li><hr class="dropdown-divider"></li>
                </ul>
            </div>
        </div>

        <div class="chat-history" id="chatContainer">
            <div id="messages"></div>
        </div>

        <div class="console-footer">
            <div class="input-group input-group-sf">
                <button id="btn_rec" class="btn btn-sf-icon" type="button" title="音声入力">
                    <i class="fas fa-microphone"></i>
                </button>
                <textarea id="user_msg" class="form-control form-control-sf" placeholder="Command..." rows="1" style="border:0px;box-shadow:none;resize:none;field-sizing:content;"></textarea>
                <button id="btn_say" class="btn btn-sf-icon" type="button" title="読み上げ切替">
                    <i class="fas fa-volume-up"></i>
                </button>
                <button id="btn_user_msg" class="btn btn-sf-icon" type="button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>

            <div class="footer-controls">
                <button id="btn_histories" class="btn btn-footer-action btn-footer-action-ps0" data-bs-toggle="modal" data-bs-target="#sessionModal">
                    <i class="fas fa-history fa-lg"></i>
                    <span>HISTORIES</span>
                </button>
                <button id="btn_memories" class="btn btn-footer-action btn-footer-action-ps0" data-bs-toggle="modal" data-bs-target="#memoryModal">
                    <i class="fas fa-brain fa-lg"></i>
                    <span>MEMORY</span>
                </button>
                <button class="btn btn-footer-action btn-footer-action-ps0" data-bs-toggle="modal" data-bs-target="#agent_settings_modal">
                    <i class="fas fa-cog fa-lg"></i>
                    <span>CONFIG</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- 左右のスプリッター -->
    <div class="split-pane-divider split-pane-divider-left"></div>

    <!-- AI Core and System Info Overlay -->
    <div class="system-location-container" style="position: absolute; top: 20px; right: 20px; text-align: right; z-index:5;" class="system-font text-white-50">
        <div id="current_time">--:--:--</div>
        <div id="appid_version">cmdbox</div>
    </div>
    <!-- Center AI Core (Default View) -->
    <div class="ai-core-container" id="aiCoreContainer">
        <div class="ai-core text-nowrap">
            <span id="display_runner_name" class="core-text" style="cursor: pointer;" title="Click to select runner">
                Click Here
            </span>
        </div>
        <div class="ai-core-msg text-nowrap">
            <span id="display_runner_msg" class="glow-text-cyan system-font" style="font-size: 0.8rem; letter-spacing: 5px; white-space:nowrap;">
                PLEASE SELECT A AGENT RUNNER
            </span>
        </div>
    </div>

    <!-- RIGHT PANEL: Visualizer / AI Monitor -->
    <main class="visualizer-panel split-pane-component split-pane-right-width">
    </main>
</div>

<!-- 設定モーダル -->
<div id="agent_settings_modal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card h-100">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Settings</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body p-0 h-100 overflow-hidden">
                <div id="settings_split_pane" class="split-pane fixed-left h-100 w-100">
                    <!-- 左側ペイン: 設定項目リスト -->
                    <div class="split-pane-component" style="width:200px;">
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action active" data-bs-target="#agent_settings">Agent Settings</a>
                            <a href="#" class="list-group-item list-group-item-action" data-bs-target="#llm_settings">LLM Settings</a>
                            <a href="#" class="list-group-item list-group-item-action" data-bs-target="#embedding_settings">Embedding Settings</a>
                            <a href="#" class="list-group-item list-group-item-action" data-bs-target="#memory_settings">Memory Settings</a>
                            <a href="#" class="list-group-item list-group-item-action" data-bs-target="#mcpsv_settings">MCPSV Settings</a>
                            <a href="#" class="list-group-item list-group-item-action" data-bs-target="#runner_settings">Runner Settings</a>
                            <a href="#" class="list-group-item list-group-item-action" data-bs-target="#tts_settings">TTS Settings</a>
                        </div>
                    </div>
                    <!-- スプリッター -->
                    <div class="split-pane-divider" style="left:200px; border: 1px solid var(--area-border-color);"></div>
                    <!-- 右側ペイン: 設定内容 -->
                    <div class="split-pane-component" style="left:200px;">
                        <div class="p-3 h-100 overflow-auto">
                            <div id="agent_settings" class="settings-content">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="m-0 glow-text-cyan system-font">Agent Settings</h6>
                                    <button id="btn_add_agent" class="btn btn-sf ms-3">
                                        <svg class="bi bi-plus" width="16" height="16" fill="currentColor"><use href="#btn_plus"></use></svg>
                                        Add Setting
                                    </button>
                                </div>
                                <div id="agent_list_container" class="list-group">
                                    <!-- Agent List Items will be injected here -->
                                </div>
                            </div>
                            <div id="llm_settings" class="settings-content d-none">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="m-0 glow-text-cyan system-font">LLM Settings</h6>
                                    <button id="btn_add_llm" class="btn btn-sf ms-3">
                                        <svg class="bi bi-plus" width="16" height="16" fill="currentColor"><use href="#btn_plus"></use></svg>
                                        Add Setting
                                    </button>
                                </div>
                                <div id="llm_list_container" class="list-group">
                                    <!-- LLM List Items will be injected here -->
                                </div>
                            </div>
                            <div id="mcpsv_settings" class="settings-content d-none">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="m-0 glow-text-cyan system-font">MCPSV Settings</h6>
                                    <button id="btn_add_mcpsv" class="btn btn-sf ms-3">
                                        <svg class="bi bi-plus" width="16" height="16" fill="currentColor"><use href="#btn_plus"></use></svg>
                                        Add Setting
                                    </button>
                                </div>
                                <div id="mcpsv_list_container" class="list-group">
                                    <!-- MCPSV List Items will be injected here -->
                                </div>
                            </div>
                            <div id="runner_settings" class="settings-content d-none">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="m-0 glow-text-cyan system-font">Runner Settings</h6>
                                    <button id="btn_add_runner" class="btn btn-sf ms-3">
                                        <svg class="bi bi-plus" width="16" height="16" fill="currentColor"><use href="#btn_plus"></use></svg>
                                        Add Setting
                                    </button>
                                </div>
                                <div id="runner_list_container" class="list-group">
                                    <!-- Runner List Items will be injected here -->
                                </div>
                            </div>
                            <div id="embedding_settings" class="settings-content d-none">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="m-0 glow-text-cyan system-font">Embedding Settings</h6>
                                    <button id="btn_add_embedding" class="btn btn-sf ms-3">
                                        <svg class="bi bi-plus" width="16" height="16" fill="currentColor"><use href="#btn_plus"></use></svg>
                                        Add Setting
                                    </button>
                                </div>
                                <div id="embedding_list_container" class="list-group">
                                    <!-- Embedding List Items will be injected here -->
                                </div>
                            </div>
                            <div id="memory_settings" class="settings-content d-none">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="m-0 glow-text-cyan system-font">Memory Settings</h6>
                                    <button id="btn_add_memory" class="btn btn-sf ms-3">
                                        <svg class="bi bi-plus" width="16" height="16" fill="currentColor"><use href="#btn_plus"></use></svg>
                                        Add Setting
                                    </button>
                                </div>
                                <div id="memory_list_container" class="list-group">
                                    <!-- Memory List Items will be injected here -->
                                </div>
                            </div>
                            <div id="tts_settings" class="settings-content d-none">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="m-0 glow-text-cyan system-font">TTS Settings</h6>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h6 class="card-title">Install TTS Engine</h6>
                                        <form id="form_tts_install" class="row"></form>
                                        <div class="mt-3 text-end">
                                            <button id="btn_install_tts" class="btn btn-sf">Install</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card mt-3">
                                    <div class="card-body">
                                        <h6 class="card-title">Uninstall TTS Engine</h6>
                                        <form id="form_tts_uninstall" class="row"></form>
                                        <div class="mt-3 text-end">
                                            <button id="btn_uninstall_tts" class="btn btn-sf-danger">Uninstall</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
            </div>
        </div>
    </div>
</div>

<!-- LLM追加/編集モーダル -->
<div id="llm_edit_modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Add/Edit LLM</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form_llm_edit" class="row"></form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
                <button type="button" class="btn btn-outline-danger me-auto" id="btn_del_llm" style="display:none;">DELETE</button>
                <button type="button" class="btn btn-footer-action btn-footer-action-ps0" id="btn_save_llm">SAVE</button>
            </div>
        </div>
    </div>
</div>

<!-- MCPSV追加/編集モーダル -->
<div id="mcpsv_edit_modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Add/Edit MCPSV</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form_mcpsv_edit" class="row"></form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
                <button type="button" class="btn btn-outline-danger me-auto" id="btn_del_mcpsv" style="display:none;">DELETE</button>
                <button type="button" class="btn btn-footer-action btn-footer-action-ps0" id="btn_save_mcpsv">SAVE</button>
            </div>
        </div>
    </div>
</div>

<!-- Agent追加/編集モーダル -->
<div id="agent_edit_modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Add/Edit Agent</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form_agent_edit" class="row"></form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
                <button type="button" class="btn btn-outline-danger me-auto" id="btn_del_agent" style="display:none;">DELETE</button>
                <button type="button" class="btn btn-footer-action btn-footer-action-ps0" id="btn_save_agent">SAVE</button>
            </div>
        </div>
    </div>
</div>

<!-- Embed追加/編集モーダル -->
<div id="embedding_edit_modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Add/Edit Embedding</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form_embedding_edit" class="row"></form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
                <button type="button" class="btn btn-outline-danger me-auto" id="btn_del_embedding" style="display:none;">DELETE</button>
                <button type="button" class="btn btn-footer-action btn-footer-action-ps0" id="btn_save_embedding">SAVE</button>
            </div>
        </div>
    </div>
</div>

<!-- Memory追加/編集モーダル -->
<div id="memory_edit_modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Add/Edit Memory</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form_memory_edit" class="row"></form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
                <button type="button" class="btn btn-outline-danger me-auto" id="btn_del_memory" style="display:none;">DELETE</button>
                <button type="button" class="btn btn-footer-action btn-footer-action-ps0" id="btn_save_memory">SAVE</button>
            </div>
        </div>
    </div>
</div>

<!-- Runner選択モーダル -->
<div id="runner_select_modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Select Runner</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="runner_select_list" class="list-group">
                    <!-- Runner List Items will be injected here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
            </div>
        </div>
    </div>
</div>

<!-- Runner追加/編集モーダル -->
<div id="runner_edit_modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">Add/Edit Runner</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form_runner_edit" class="row"></form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
                <button type="button" class="btn btn-outline-danger me-auto" id="btn_del_runner" style="display:none;">DELETE</button>
                <button type="button" class="btn btn-footer-action btn-footer-action-ps0" id="btn_save_runner">SAVE</button>
            </div>
        </div>
    </div>
</div>

<!-- セッションモーダル -->
<div id="sessionModal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-cyan system-font">SESSION ARCHIVES</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <ul class="sf-list-group">
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
            </div>
        </div>
    </div>
</div>

<!-- メモリーモーダル -->
<div id="memoryModal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content sf-modal doc-card" style="height:auto;">
            <div class="modal-header doc-header">
                <h5 class="modal-title glow-text-magenta system-font">MEMORY SYNC STATUS</h5>
                <button type="button" class="btn btn-sf-icon" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="sf-param-grid mb-3">
                    <div class="sf-param-box">
                        <span class="d-block text-white-50" style="font-size: 0.8rem;">TRUST_LEVEL</span>
                        <div class="display-6 system-font glow-text-cyan">87%</div>
                    </div>
                    <div class="sf-param-box">
                        <span class="d-block text-white-50" style="font-size: 0.8rem;">SYNC_RATE</span>
                        <div class="display-6 system-font glow-text-magenta">94.2%</div>
                    </div>
                </div>
                <h6 class="glow-text-cyan system-font mt-4 mb-2"><i class="fas fa-file-alt me-2"></i>USER_PROFILE_ANALYSIS</h6>
                <div class="p-3 border border-secondary bg-black bg-opacity-25" style="font-family: var(--font-body);">
                    <p id="memory_content" class="mb-2"><strong>Loading..</strong></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">CLOSE</button>
            </div>
        </div>
    </div>
</div>
<!-- ローディングマスク -->
<div id="loading" class="position-absolute top-0 start-0 w-100 h-100 d-none" style="background:rgba(0, 0, 0, 0.3);z-index:10000;">
    <div class="text-center position-absolute top-50 start-50 w-100 translate-middle">
        <div class="spinner-border text-light" role="status">
            <span class="sr-only"></span>
        </div>
        <div>
            <button type="button" class="btn btn-outline-danger mt-3 bbforce">Back by force</button>
        </div>
    </div>
</div>
<!-- フッター -->
<footer class="copyright"></footer>
<script type="text/javascript">
    document.getElementById('loading').classList.remove('d-none');
</script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Agent Logic Script -->
<link rel="stylesheet" href="assets/split-pane/split-pane.css">
<script type="text/javascript" src="assets/jquery/jquery.min.3.2.0.js"></script>
<script type="text/javascript" src="assets/jquery-ui/jquery-ui.min.js"></script>
<script type="text/javascript" src="assets/split-pane/split-pane.js"></script>
<script type="text/javascript" src="assets/cmdbox/svgicon.js"></script>
<script type="text/javascript" src="assets/cmdbox/common.js"></script>
<script type="text/javascript" src="assets/cmdbox/view_result.js"></script>
<script type="text/javascript" src="assets/agent/agent.js"></script>
<script type="text/javascript" src="assets/agent/main.js"></script>
</body>
</html>